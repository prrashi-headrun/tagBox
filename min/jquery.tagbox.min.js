(function($){"use strict";if(String.prototype.trim!=="function"){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}}var e={};var t=13,n=37,r=38,a=39,o=50,i=8,l=27;function s(e,t){var n=$(e).text().length;if(t==="start"){t=0}else if(t==="end"){t=n}var r=null;if(typeof window.getSelection!=="undefined"&&typeof document.createRange!=="undefined"){r=document.createRange();e=e.childNodes[0];r.setStart(e,t);r.setEnd(e,n);r.collapse(true);var a=window.getSelection();a.removeAllRanges();a.addRange(r)}else if(typeof document.body.createTextRange!=="undefined"){r=document.body.createTextRange();r.moveToElementText(e);r.collapse(false);r.select()}}function f(e){e.siblings("span.tagbox-wg[contenteditable]").removeAttr("contenteditable");return e.attr("contenteditable","true").focus()}function c(e,t,n){t=t||"";e.children("span.tagbox-wg").removeAttr("contenteditable");var r=$("<span/>").addClass("tagbox-wg")[n?"html":"text"](t).appendTo(e);return f(r)}function d(e){var t=e.prev();if(t.length===0){return e.text("")}else{while(e.prev(".tagbox-wg").length===0){e.prev().remove()}t=e.prev();var n=e.text(),r=t.text();f(t);if(n.length>0){t.text(r+n)}e.remove();s(t.get(0),r.length);return t}}function u(e,n){var r=n.autoFillData;var a=e.val().trim();var o=$("<div/>").addClass("tagbox-container").insertBefore(e);e.hide().appendTo(o);var l=$("<div/>").addClass("tagbox tagbox-input").prependTo(o);var s=c(l,a);function u(e){var t=$(e.target);if(t.hasClass("tagbox-wg")){s=f(t)}}o.on("click",u).on("keyup","[contenteditable='true']",function(e){}).on("keydown","[contenteditable='true']",function(e){var n=e.which||e.keyCode;var r=window.getSelection(),a=r.focusOffset;if(n===t){e.preventDefault();var o=$("<br/>");var u=s.text();var g,v;if(a===0&&u.length!==0){o.insertBefore(s);c(l).insertBefore(o);f(s)}else{o.insertAfter(s);g=u.substr(0,a);v=u.substr(a);s.text(g);s=c(l,v);f(s.insertAfter(o))}}else if(n===i){if(s.text().length===0||a===0){e.preventDefault();s=d(s)}}})}function g(t){t=$.extend(t,e);return $.each(this,function(e,n){var r=n.tagName;if(r==="TEXTAREA"||r==="INPUT"){u($(n),t)}})}$.fn.tagBox=g})(jQuery);